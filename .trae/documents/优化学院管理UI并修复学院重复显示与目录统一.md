## 问题与目标
- 学院管理存在“economy”与“经济学院”重复显示，源于目录与学院集合的混合策略（代码目录与中文目录）。
- 初始进入学院管理仅显示各学院进度缩略图（中文名、不同背景色），并在下方提供“新增学院”入口；点击“查看详情”进入目标设置视图，保存后立即刷新。

## 数据层修复（统一学院集合与目录映射）
1. 学院集合统一：
   - `get_colleges()`仅返回来自`users.yaml`的`college_code`集合，不再与`storage/`目录并集；移除`KNOWN_COLLEGES`并集，避免重复。
   - 新增`load_college_mapping()`返回 `{code: 中文名}` 与反向 `{中文名: code}`，便于反向映射。
2. 目录读写兼容：
   - 保持写入优先中文目录（更友好），读取时针对某`code`同时扫描其中文目录与旧代码目录（沿用已实现的`_dirnames_for_college*`逻辑）。
   - 在合并与列表函数中统一将`df['college']`映射为中文名，计数合并不重复。
3. 重复学院修补：
   - 汇总统计与学院管理中使用`get_colleges()`的代码集合驱动UI；展示层通过`get_college_display(code)`显示中文名，保证“一学院一项”。
   - 若已经存在`storage/economy`与`storage/经济学院`两套目录，读取时合并统计，不重复生成两个 UI 卡片。

## 学院管理UI重构
1. 入口视图（缩略图网格）：
   - 每个学院以卡片/容器显示：中文名、问答对与习题达标进度条、当前数量/目标；背景色依据学院配置（静态配色字典）。
   - 网格：3列布局，卡片高度一致；各卡片提供“查看详情”按钮。
   - 页面底部新增“➕ 添加学院”按钮（或图标按钮）进入新增学院表单。
2. 详情视图（目标设置为主）：
   - 当点击“查看详情”时，仅展示目标设置区域：问答对数、习题数、各题型目标数值输入；
   - 保存后调用`save_targets()`并`st.experimental_rerun()`立即刷新缩略图进度。
   - 可折叠查看上传记录与预览（保持现有展开逻辑，但默认折叠）。
3. 背景色与中文名：
   - 新增`COLLEGE_COLORS = {code: "#RRGGBB"}`；卡片容器通过`st.markdown`注入内联样式或`st.container`+`st.write`配合`unsafe_allow_html`实现。
   - 所有显示使用中文名：`get_college_display(code)`。

## 交互与刷新
- “查看详情”时将`session_state['manage_sel_code']`设置为学院`code`（不再存中文名），避免键值不匹配；`selectbox`默认选中对应中文名。
- 保存目标后：`st.success("已保存")`与`st.experimental_rerun()`重绘缩略图。

## 代码改动点
- `modules/storage.py`：
  - 更新`get_colleges()`为仅从`users.yaml`读取代码集合；
  - 保留并完善`load_college_mapping()`与反向映射；
  - 维持双目录读取函数，写入使用中文目录。
- `modules/auth.py`：
  - 已支持`name`与`college_code`；确保`get_user_info`返回`college`为代码（供内部使用），显示取`name`。
- `app.py`：
  - 学院管理入口改为网格卡片视图，移除初始即显示全部详情的逻辑；
  - 点击“查看详情”后，仅渲染目标设置与折叠的上传记录预览；
  - 统一以代码驱动状态，并用`get_college_display`展示；
  - 修正之前的`KeyError`问题：会话和选择框均用一致的键（代码→中文名映射）。

## 验证
- 运行测试套件；
- 人工场景验证：
  - 存在`storage/economy`与`storage/经济学院`双目录时，UI仅显示一个“经济学院”卡片；计数为两目录合计；
  - 在“查看详情”保存目标后，缩略图进度立即更新；
  - 新增学院后可见新卡片并可设置目标。

## 迁移提示
- 可选：编写一次性迁移脚本将旧代码目录移动到中文目录；当前兼容读取已足够，不强制迁移。